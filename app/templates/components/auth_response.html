{% if error %}
<div class="bg-red-50 border-l-4 border-red-400 p-4 mb-4 rounded shadow-sm">
  <div class="flex items-center">
    <div class="flex-shrink-0">
      <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
      </svg>
    </div>
    <div class="ml-3">
      <p class="text-sm text-red-700 font-medium">{{ error }}</p>
    </div>
  </div>
</div>

<script>
  (function() {
    console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', '{{ error }}');
    
    // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®å‡¦ç†
    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¦ç´ ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    const loginResponseElement = document.getElementById('login-response');
    if (loginResponseElement) {
      loginResponseElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
      
      // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æˆ»ã™
      const usernameField = document.getElementById('login-username');
      if (usernameField) {
        setTimeout(() => {
          usernameField.focus();
        }, 500);
      }
    }
  })(); // å³æ™‚å®Ÿè¡Œé–¢æ•°ã§ã‚¹ã‚³ãƒ¼ãƒ—ã‚’åˆ†é›¢
</script>
{% endif %}

{% if success %}
<div class="bg-green-50 border-l-4 border-green-400 p-4 mb-4 rounded shadow-sm">
  <div class="flex items-center">
    <div class="flex-shrink-0">
      <svg class="h-5 w-5 text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
      </svg>
    </div>
    <div class="ml-3">
      <p class="text-sm text-green-700 font-medium">{{ success }}</p>
    </div>
  </div>
</div>

<script>
  (function() {
    // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒ
    console.log("èªè¨¼æˆåŠŸ: {{ user_name|default('') }}");
    
    // èªè¨¼æˆåŠŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒï¼ˆAlpine.jsç”¨ï¼‰
    console.log("ğŸ” auth:login-success ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ã¾ã™");
    document.dispatchEvent(new CustomEvent('auth:login-success', { 
      detail: { 
        userName: '{{ user_name|default("") }}' 
      } 
    }));
    
    // æ¨™æº–èªè¨¼ã‚¤ãƒ™ãƒ³ãƒˆã‚‚ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒ
    console.log("ğŸ”‘ auth:login ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ã¾ã™");
    document.dispatchEvent(new CustomEvent('auth:login', { 
      detail: { 
        userName: '{{ user_name|default("") }}' 
      } 
    }));
    
    {% if reload %}
    // ãƒªãƒ­ãƒ¼ãƒ‰å‰ã«å°‘ã—å¾…æ©Ÿã—ã¦æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
    setTimeout(function() {
      console.log("ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™...");
      window.location.reload();
    }, 1500);
    {% endif %}
    
    // æˆåŠŸæ™‚ã®ã¿ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ï¼ˆç´”ç²‹ãªDOMã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰
    setTimeout(() => {
      console.log("ğŸ”’ DOMæ“ä½œã§èªè¨¼ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹è©¦è¡Œ...");
      const modal = document.getElementById('loginModal');
      if (modal) {
        modal.style.display = 'none';
        console.log("ğŸ”’ DOMã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’éè¡¨ç¤ºã«è¨­å®šã—ã¾ã—ãŸ");
      }
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã‚‚ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒï¼ˆäºŒé‡ä¿é™ºï¼‰
      console.log("ğŸ”’ modal-closeã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ã¾ã™");
      document.dispatchEvent(new CustomEvent('modal-close', { 
        detail: { id: 'loginModal' } 
      }));
    }, 500);
  })(); // å³æ™‚å®Ÿè¡Œé–¢æ•°ã§ã‚¹ã‚³ãƒ¼ãƒ—ã‚’åˆ†é›¢
</script>
{% endif %}
