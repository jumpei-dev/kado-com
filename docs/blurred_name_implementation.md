# blurred_nameæ©Ÿèƒ½ã®å®Ÿè£…

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€åº—èˆ—åã®ã¼ã‹ã—è¡¨ç¤ºæ©Ÿèƒ½ï¼ˆblurred_nameï¼‰ã®å®Ÿè£…ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## æ¦‚è¦

blurred_nameæ©Ÿèƒ½ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã«å¿œã˜ã¦åº—èˆ—åã‚’éƒ¨åˆ†çš„ã«éš ã™æ©Ÿèƒ½ã§ã™ã€‚
`can_see_contents=false` ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯åº—èˆ—åãŒã€Œã€‡ã€‡ã€‡ã€‡ãƒ•ã‚§ã‚¶ãƒ¼ã€ã®ã‚ˆã†ãªå½¢ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## å®Ÿè£…æ–¹é‡ã®å¤‰æ›´

### å¾“æ¥ã®å®Ÿè£…ï¼ˆå‹•çš„ç”Ÿæˆï¼‰
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãŸã³ã«åº—èˆ—åã‹ã‚‰blurred_nameã‚’å‹•çš„ç”Ÿæˆ
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæ‚ªãã€ä¸€è²«æ€§ã«æ¬ ã‘ã‚‹

### æ–°ã—ã„å®Ÿè£…ï¼ˆDBäº‹å‰ä¿å­˜ï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«äº‹å‰ã«blurred_nameã‚’ä¿å­˜
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã¨è¡¨ç¤ºã®ä¸€è²«æ€§ã‚’å®Ÿç¾
- å¿…è¦ã«å¿œã˜ã¦æ‰‹å‹•èª¿æ•´ã‚‚å¯èƒ½

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
app/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ auth.py          # /me ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 
â”‚   â””â”€â”€ stores.py        # æ¨©é™ãƒã‚§ãƒƒã‚¯çµ±åˆã€å‹•çš„ç”Ÿæˆå‰Šé™¤
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ blurred_name_utils.py  # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â””â”€â”€ templates/components/
    â”œâ”€â”€ store_card.html    # æ¨©é™è¡¨ç¤ºã‚¢ã‚¤ã‚³ãƒ³è¿½åŠ 
    â””â”€â”€ store_detail.html  # æ¨©é™è¡¨ç¤ºã‚¢ã‚¤ã‚³ãƒ³è¿½åŠ 

data/
â””â”€â”€ blurred_names_template.csv  # CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

update_blurred_names.py     # æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

## ä¸»ãªå¤‰æ›´å†…å®¹

### 1. auth.py - æ¨©é™ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 

```python
@router.get("/me")
async def get_current_user(request: Request) -> dict:
    """ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—"""
    # ã‚¯ãƒƒã‚­ãƒ¼ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã‚’è¿”ã™
```

### 2. stores.py - DBå€¤ä½¿ç”¨ã¸ã®å¤‰æ›´

```python
# å‹•çš„ç”Ÿæˆé–¢æ•°ã‚’å‰Šé™¤
# def apply_name_blurring(name: str, can_see_contents: bool) -> dict:

# DBå€¤ã‚’ä½¿ç”¨ã™ã‚‹æ–°ã—ã„é–¢æ•°
from app.utils.blurred_name_utils import get_store_display_info
```

### 3. blurred_name_utils.py - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

- `generate_blurred_name()`: è‡ªå‹•ç”Ÿæˆãƒ«ãƒ¼ãƒ«
- `get_store_display_info()`: æ¨©é™ã«å¿œã˜ãŸè¡¨ç¤ºåæ±ºå®š
- `validate_blurred_name()`: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- `get_blurred_name_statistics()`: è¨­å®šçŠ¶æ³çµ±è¨ˆ

### 4. update_blurred_names.py - æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
# è‡ªå‹•ç”Ÿæˆã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
python update_blurred_names.py --auto-generate --preview

# CSVã‹ã‚‰æ›´æ–°
python update_blurred_names.py --from-csv data/blurred_names_template.csv

# ç¾åœ¨ã®çŠ¶æ³ã‚’CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
python update_blurred_names.py --export-csv current_stores.csv
```

## ã¼ã‹ã—å‡¦ç†ãƒ«ãƒ¼ãƒ«

| æ–‡å­—æ•° | ãƒ«ãƒ¼ãƒ« | ä¾‹ |
|--------|---------|-----|
| 1-2æ–‡å­— | å…¨ã¦ã€‡ | `AB` â†’ `ã€‡ã€‡` |
| 3-4æ–‡å­— | æœ€å¾Œ1æ–‡å­—ä»¥å¤–ã€‡ | `ABC` â†’ `ã€‡ã€‡C` |
| 5æ–‡å­—ä»¥ä¸Š | æœ€å¾Œ2-3æ–‡å­—ä»¥å¤–ã€‡ | `ã‚¨ãƒ³ã‚¸ã‚§ãƒ«ãƒ•ã‚§ã‚¶ãƒ¼` â†’ `ã€‡ã€‡ã€‡ã€‡ã€‡ãƒ•ã‚§ã‚¶ãƒ¼` |

## æ¨©é™ã«ã‚ˆã‚‹è¡¨ç¤ºåˆ¶å¾¡

### can_see_contents = true ã®å ´åˆ
- `display_name`: å…ƒã®åº—èˆ—å
- `is_blurred`: false
- ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºãªã—

### can_see_contents = false ã®å ´åˆ
- `display_name`: blurred_name
- `is_blurred`: true  
- ğŸ”’ ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º

## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã®ä½¿ç”¨æ–¹æ³•

```html
<!-- åº—èˆ—åè¡¨ç¤º -->
<h3>{{ store.name }}</h3>

<!-- æ¨©é™åˆ¶é™ã‚¢ã‚¤ã‚³ãƒ³ -->
{% if store.is_blurred %}
<div class="bg-orange-100 text-orange-600" title="æ¨©é™ãŒå¿…è¦ã§ã™">
  <svg>ğŸ”’</svg>
</div>
{% endif %}
```

## ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ‰‹é †

### 1. ç¾åœ¨ã®çŠ¶æ³ç¢ºèª
```bash
python update_blurred_names.py --auto-generate --preview
```

### 2. CSVã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
```bash
# ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
python update_blurred_names.py --export-csv stores.csv

# stores.csvã‚’ç·¨é›†ã—ã¦blurred_nameã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

# ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸCSVã‹ã‚‰æ›´æ–°
python update_blurred_names.py --from-csv stores.csv --preview
```

### 3. å®Ÿéš›ã®æ›´æ–°å®Ÿè¡Œ
```bash
python update_blurred_names.py --auto-generate  # ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚ã‚Š
```

## å‹•ä½œç¢ºèª

### 1. ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ
```bash
python app/utils/blurred_name_utils.py
```

### 2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
```bash
python run_app.py
```

### 3. ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆçŠ¶æ…‹ã§åº—èˆ—ä¸€è¦§ã‚’ç¢ºèªï¼ˆã¼ã‹ã—è¡¨ç¤ºã«ãªã£ã¦ã„ã‚‹ã‹ï¼‰
- ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«åº—èˆ—ä¸€è¦§ã‚’ç¢ºèªï¼ˆå…ƒã®åå‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ï¼‰
- ğŸ”’ ã‚¢ã‚¤ã‚³ãƒ³ãŒé©åˆ‡ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‹

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### blurred_nameãŒè¡¨ç¤ºã•ã‚Œãªã„
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®`can_see_contents`ãƒ•ãƒ©ã‚°ã‚’ç¢ºèª
2. `/api/auth/me`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å¿œç­”ç¢ºèª
3. JavaScriptã®æ¨©é™ãƒã‚§ãƒƒã‚¯å‹•ä½œç¢ºèª

### æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ãƒ©ãƒ¼
1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
2. CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ç¢ºèªï¼ˆUTF-8, ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰
3. æ¨©é™ãƒ»ãƒ‘ã‚¹ç¢ºèª

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ
- DBã®blurred_nameãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ã‚’æ¤œè¨
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®è¿½åŠ ã‚’æ¤œè¨

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

1. **è©³ç´°æ¨©é™åˆ¶å¾¡**: åº—èˆ—ã”ã¨ã®å€‹åˆ¥æ¨©é™è¨­å®š
2. **å‹•çš„ã¼ã‹ã—ãƒ¬ãƒ™ãƒ«**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸã¼ã‹ã—å¼·åº¦
3. **ãƒ­ã‚°æ©Ÿèƒ½**: blurred_nameè¡¨ç¤ºã®ç›£æŸ»ãƒ­ã‚°
4. **ç®¡ç†ç”»é¢**: blurred_nameã®ä¸€æ‹¬ç·¨é›†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
